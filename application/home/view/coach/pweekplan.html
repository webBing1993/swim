{extend name="public/common"}

{block name="style"}
<title>训练档案</title>
<link rel="stylesheet" href="/static/mobiscroll/mobiscroll.2.13.2.css">
<link rel="stylesheet" href="/home/css/coach/publish.css">
{/block}

{block name="body"}
<div class="main">
	<div class="tag">周计划</div>
	<div class="list clear">
		<span class="title fl">计划标题</span>
		<span class="fa fa-angle-right fr"></span>
		<input type="text" placeholder="请输入计划标题" class="fr limit" name="title" value="{$res.title|default=''}">
	</div>
	<div class="list clear">
		<span class="title fl">开始时间</span>
		<span class="fa fa-angle-right fr"></span>
		<input type="text" value="{$res.start_time|default=date('Y-m-d')}" class="fr" readonly="readonly" id="start" name="start">
	</div>
	<div class="list clear">
		<span class="title fl">结束时间</span>
		<span class="fa fa-angle-right fr"></span>
		<input type="text" value="{$res.end_time|default=date('Y-m-d')}" class="fr"  readonly="readonly" id="end" name="end">
	</div>
	<div class="list">
		<span class="title">任务需求</span>
		<div class="content">
			<textarea name="need" id="need" placeholder="请输入不多于200字。">{$res.need|default=''}</textarea>
			<div class="sum"><span>0</span>/200</div>
		</div>
	</div>
	<div class="tag">计划内容</div>
	<div class="list clear templet" data-tab="0">
		<span class="title fl">星期一</span>
		<span class="fa fa-angle-right fr"></span>
	</div>
	<div class="list clear templet" data-tab="1">
		<span class="title fl">星期二</span>
		<span class="fa fa-angle-right fr"></span>
	</div>
	<div class="list clear templet" data-tab="2">
		<span class="title fl">星期三</span>
		<span class="fa fa-angle-right fr"></span>
	</div>
	<div class="list clear templet" data-tab="3">
		<span class="title fl">星期四</span>
		<span class="fa fa-angle-right fr"></span>
	</div>
	<div class="list clear templet" data-tab="4">
		<span class="title fl">星期五</span>
		<span class="fa fa-angle-right fr"></span>
	</div>
	<div class="list clear templet" data-tab="5">
		<span class="title fl">星期六</span>
		<span class="fa fa-angle-right fr "></span>
	</div>
	<div class="list clear templet" data-tab="6">
		<span class="title fl">星期天</span>
		<span class="fa fa-angle-right fr"></span>
	</div>
	<div class="save">一键保存</div>
</div>
<!--日模板-->
<div class="bg">
	<div class="list clear">
		<span class="title fl">计划时间</span>
		<span class="fr limit week" data-tab="0">星期一</span>
	</div>
	<div class="list">
		<span class="title">训练内容</span>
		<table>
			<tr>
				<td>序号</td>
				<td>组数</td>
				<td>个数</td>
				<td>距离</td>
				<td>项目</td>
				<td>详情</td>
			</tr>
			<!--<tr>-->
				<!--<td>1</td>-->
				<!--<td class="group">1</td>-->
				<!--<td class="num">1</td>-->
				<!--<td class="distance">-</td>-->
				<!--<td class="pose">-</td>-->
				<!--<td class="detail">-</td>-->
			<!--</tr>-->
		</table>
		<span class="fa fa-plus addList"></span>
		<!--<div class="content">-->
		<!--<textarea name="content" id="content" placeholder="输入不多于200字。"></textarea>-->
		<!--<div class="sum"><span>0</span>/200</div>-->
		<!--</div>-->
	</div>
	<div class="list">
		<span class="title">自定义训练内容</span>
		<div class="content">
			<textarea name="contentself" id="contentself" placeholder="请输入自定义训练内容。">{$res.contentself|default=''}</textarea>
		</div>
	</div>
	<div class="list clear">
		<span class="title fl">负荷</span>
		<div class="load fr radiogroup">
			<span class="active">低</span>
			<span>中低</span>
			<span>中</span>
			<span>中高</span>
			<span>高</span>
		</div>
	</div>
	<div class="list clear">
		<span class="title fl">时间（h）</span>
		<div class="duration fr radiogroup">
			<span class="active">1</span>
			<span>1.5</span>
			<span>2</span>
			<span>2.5</span>
			<span>3</span>
		</div>
	</div>
	<div class="daysave">保存并返回</div>
</div>
{/block}

{block name="script"}
<script src="/static/mobiscroll/mobiscroll.2.13.2.js"></script>
<script>
$(function(){
	//时间选择
	timeSelect();
	//字数统计
	wordSum();
	//内容模板
	templet();
	//保存周计划
	weekSave();
	//保存日计划
	daySave();
	//单选
	radio();
	//新增训练内容
	addList();
	//判断是否有值
//    Judge ();
});
function  addList(){
	$('.addList').off('click').on('click',function(){
		var num = $('tr').length;
		var html =
			'<tr>'+
			'<td>'+num+'</td>'+
			'<td class="group">1</td>'+
			'<td class="num">1</td>'+
			'<td class="distance">-</td>'+
			'<td class="pose">-</td>'+
			'<td class="detail">-</td>'+
			'</tr>';
		$('table').append(html);
		radio();
	})
}
function radio(){
	var grouphtml =
		'<div class="rs">'+
		'<div>1</div>'+
		'<div>2</div>'+
		'<div>3</div>'+
		'<div>4</div>'+
		'<div>5</div>'+
		'<div>6</div>'+
		'<div>8</div>'+
		'<div>10</div>'+
		'<div>16</div>'+
		'<div>20</div>'+
		'</div>';
	var distancehtml =
		'<div class="rs">'+
		'<div>1600</div>'+
		'<div>800</div>'+
		'<div>400</div>'+
		'<div>200</div>'+
		'<div>100</div>'+
		'<div>50</div>'+
		'<div>25</div>'+
		'<div>15</div>'+
		'</div>';
	var posehtml =
		'<div class="rs">'+
		'<div>蛙泳</div>'+
		'<div>仰泳</div>'+
		'<div>蝶泳</div>'+
		'<div>自由泳</div>'+
		'<div>混合</div>'+
		'<div>潜泳</div>'+
		'</div>';
	var detailhtml =
		'<div class="rs">'+
		'<div>手</div>'+
		'<div>腿</div>'+
		'<div>手+腿</div>'+
		'<div>分解+配合</div>'+
		'</div>';
	var html = [grouphtml,grouphtml,distancehtml,posehtml,detailhtml];
	$('.radiogroup span').off('click').on('click',function(){
		$(this).addClass('active');
		$(this).siblings('span').removeClass('active');
	});
	$('td').off('click').on('click',function(){
		var td = $(this).index();
		var tr = $(this).parents('tr').index();
		if(td!=0 && tr!=0){
			$('.rs').remove();
			var index = $(this).index();
			$(this).append(html[index-1]);
			$('.rs div').off('click').on('click',function(){
				var text = $(this).text();
				$(this).parents('td').replaceWith('<td>'+text+'</td>');
				radio();
               /// Judge ();
			});
		}

	});
}
var days=new Array(7);
var contents={$contents};
var clen = contents.length;
if(clen > 0){
	for(var i = 0 ; i<clen;i++){
		days[contents[i].type - 1]= contents[i]
	}
}
function weekSave(){
	$('.save').off('click').on('click',function(){
		var data ={
			id:"{$res.id ? $res.id : '';}",
			title:$('input[name=title]').val(),
			start:$('input[name=start]').val(),
			end:$('input[name=end]').val(),
			need:$('#need').val(),
		};
//		if(isAll(data)){
			data['days'] =days;
			$.ajax({
				type:"post",
				url:"",
				data:data,
				success:function(data){
//					var lists = $.parseJSON( data );
					swal( {
						title: '提示',
						text: '保存成功',
						type: 'success',
						showConfirmButton: true,
					}).then(function(isConfirm){
						if (isConfirm) {
							window.location.href = '/home/coach/weekPlan/id/0'
						}})
				}
			})
//		}else{
//			swal({
//				title: '提示',
//				text: '请完善您的信息',
//				type: 'error',
//				showConfirmButton:true,
//				timer:3000
//			})
//			}
		})
}
function daySave(){
	$('.daysave').off('click').on('click',function(){
		var content = [];
		var lists = $('table tr');
		var len = lists.length;
		for(var i = 1;i <len ;i++){
			var list = lists.eq(i);
			var group = list.find('td').eq(1).text();
			var num = list.find('td').eq(2).text();
			var distance = list.find('td').eq(3).text();
			var pose = list.find('td').eq(4).text();
			var detail = list.find('td').eq(5).text();
            if(distance == "-" || pose == '-' || detail =='-'){
                swal({
                    title: '提示',
                    text: '请填写完整信息',
                    type: 'error',
                    showConfirmButton: true,
                    timer: 2000
                })
            }else {
                $('.bg').fadeOut();
				$('.main').fadeIn();
				enable_back();
			}
			content.push([group,num,distance,pose,detail])
		}
		if(len!=1){
			var data ={
				content:content,
				contentself:$('#contentself').val(),
				load:$('.load span.active').index()+1,
				duration:$('.duration span.active').index()+1
			};
			console.log(data);
			var index = $('.week').attr('data-tab');
			days[index] = data;
			$('.templet').eq(index).find('.fa-angle-right').addClass('green');
		}

//		if($('input[name=load]').val()!=''&&$('input[name=content]').val()!=''){
//		$('.templet').eq(index).find('.fa-angle-right').addClass('green');
//		}else{
//			$('.templet').eq(index).find('.fa-angle-right').removeClass('green');
//		}
//		$('.bg').fadeOut();
//		$('.main').fadeIn();
//		enable_back();
	})
}
function templet(){
	$('.templet').off('click').on('click',function(){
		var index = $(this).attr('data-tab');
		var name = $(this).find('.title').text();
		$('.week').text(name).attr('data-tab',index);
		fobidden_back();
		$('.main').fadeOut();
		$('.bg').fadeIn();
		var html = '<tr> <td>序号</td> <td>组数</td> <td>个数</td> <td>距离</td> <td>项目</td> <td>详情</td> </tr>';
		if(days[index]){
			var trs = days[index].content;
			var len = trs.length;
			for(var i = 0 ; i<len;i++){
				html+=
					'<tr>'+
					'<td>'+(i+1)+'</td>'+
					'<td class="group">'+trs[i][0]+'</td>'+
					'<td class="num">'+trs[i][1]+'</td>'+
					'<td class="distance">'+trs[i][2]+'</td>'+
					'<td class="pose">'+trs[i][3]+'</td>'+
					'<td class="detail">'+trs[i][4]+'</td>'+
					'</tr>';
			}
			$('table').html(html);
			radio();
			$('#contentself').val(days[index].contentself);
			$('.load span').eq(days[index].load-1).addClass('active').siblings('span').removeClass('active');
			$('.duration span').eq(days[index].duration-1).addClass('active').siblings('span').removeClass('active');
		}else{
			html +='';
//				'<tr>'+
//				'<td>1</td>'+
//				'<td class="group">1</td>'+
//				'<td class="num">1</td>'+
//				'<td class="distance">-</td>'+
//				'<td class="pose">-</td>'+
//				'<td class="detail">-</td>'+
//				'</tr>';
			$('table').html(html);
			$('#contentself').val('');
			$('.load span').eq(0).addClass('active').siblings('span').removeClass('active');
			$('.duration span').eq(0).addClass('active').siblings('span').removeClass('active');
		}
		radio();
		});
}
function wordSum(){
     var len = $("#need").val().length;
    $('.sum').find('span').text(len);
	$('#need,#load,#content').on('input',function(){
		var len = $(this).val().length;
		$(this).next('.sum').find('span').text(len);
		if(len > 20){
			$(this).next('.sum').find('span').addClass('red');
		}else{
			$(this).next('.sum').find('span').removeClass('red');
		}
	});
}
function timeSelect(){
	var currYear = (new Date()).getFullYear();
	var opt={};
	opt.date = {preset : 'date'};
	opt.default = {
		theme: 'android-holo light',
		display: 'modal',
		mode: 'scroller',
		dateFormat: 'yy-mm-dd',
		lang: 'zh',
		showNow: true,
		nowText: "今天",
		startYear: currYear,
		endYear: currYear + 50,
		onSelect: function (valueText, inst) {
			var start = $('#start').val();
			var end = $('#end').val();
		}
	};
	$("#start").mobiscroll($.extend(opt['date'], opt['default']));
	$("#end").mobiscroll($.extend(opt['date'], opt['default']));
}
function temShow(data){
	$('.choose').off('click').on('click',function(){
		$('.tems').fadeIn();
		$('.tems div').off('click').on('click',function(){
			var index = $(this).index();
			$('input[name=load]').val(data[index].load);
			$('input[name=content]').val(data[index].content);
		});
	})
}

</script>
{/block}