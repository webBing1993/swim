{extend name="public/common"}

{block name="style"}
<title>训练档案</title>
<link rel="stylesheet" href="/static/mobiscroll/mobiscroll.2.13.2.css">
<link rel="stylesheet" href="/home/css/coach/publish.css">
{/block}

{block name="body"}
<div class="tag">课时计划</div>
<div class="list clear">
	<span class="title fl">计划标题</span>
	<span class="fa fa-angle-right fr"></span>
	<input type="text" placeholder="请输入标题" class="fr limit" name="title">
</div>
<div class="list clear">
	<span class="title fl">课时时间</span>
	<span class="fa fa-angle-right fr"></span>
	<input type="text" value="2011-1-1" class="fr" readonly="readonly" id="start" name="start">
</div>
<div class="list">
	<span class="title">任务需求</span>
	<div class="content">
		<textarea name="need" id="need" placeholder="输入不多于200字。"></textarea>
		<div class="sum"><span>0</span>/200</div>
	</div>
</div>
<div class="tag">计划内容</div>
<div class="list clear templet" data-tab="0">
	<span class="title fl">准备部分</span>
	<span class="fa fa-angle-right fr"></span>
</div>
<div class="list clear templet" data-tab="1">
	<span class="title fl">基本部分</span>
	<span class="fa fa-angle-right fr"></span>
</div>
<div class="list clear templet" data-tab="2">
	<span class="title fl">结束部分</span>
	<span class="fa fa-angle-right fr"></span>
</div>
<div class="tag">计划小结</div>
<div class="list">
	<span class="title">课后小结</span>
	<div class="content">
		<textarea name="summary" id="summary" placeholder="输入不多于200字。"></textarea>
		<div class="sum"><span>0</span>/200</div>
	</div>
</div>
<div class="save">一键保存</div>
<!--日模板-->
<div class="bg">
	<div class="list clear">
		<span class="title fl">计划部分</span>
		<span class="fr limit week" data-tab="0">星期一</span>
	</div>
	<div class="list clear choose">
		<span class="title fl">选择模板</span>
		<span class="fa fa-angle-down fr"></span>
		<span class="fr limit tem">自定义</span>
	</div>
	<div class="tems">
		<div>自定义</div>
		<div>末班一</div>
		<div>moban2</div>
		<div>末班一</div>
	</div>
	<div class="list">
		<span class="title">训练内容</span>
		<div class="content">
			<textarea name="content" id="content" placeholder="输入不多于200字。"></textarea>
			<div class="sum"><span>0</span>/200</div>
		</div>
	</div>
	<div class="list clear">
		<span class="title fl">负荷量</span>
		<span class="fa fa-angle-right fr"></span>
		<input type="text" placeholder="请输入负荷量" class="fr limit" name="load">
	</div>
	<div class="list clear">
		<span class="title fl">负荷强度</span>
		<span class="fa fa-angle-right fr"></span>
		<input type="text" placeholder="请输入负荷强度" class="fr limit" name="strength">
	</div>
	<div class="list clear">
		<span class="title fl">时间</span>
		<span class="fa fa-angle-right fr"></span>
		<input type="text" placeholder="请输入时间" class="fr limit" name="duration">
	</div>
	<div class="daysave">一键保存</div>
</div>
{/block}

{block name="script"}
<script src="/static/mobiscroll/mobiscroll.2.13.2.js"></script>
<script>
$(function(){
	//时间选择
	timeSelect();
	//字数统计
	wordSum();
	//内容模板
	templet();
	//保存周计划
	weekSave();
	//保存日计划
	daySave();
});
var parts=new Array(3);
function weekSave(){
	$('.weeksave').off('click').on('click',function(){
		var data ={
			title:$('input[name=title]').val(),
			start:$('input[name=start]').val(),
			need:$('#need').val(),
			summary:$('#summary').val()
		};
		if(isAll(data)){
			data[parts] =parts;
			$.ajax({
				type:"post",
				url:"",
				data:{

				},
				success:function(data){
					var lists = $.parseJSON(data);
				}
			});
		}else{
			swal({
				title: '提示',
				text: '请完善您的信息',
				type: 'error',
				showConfirmButton:true,
				timer:3000
			})
		}

	})
}
function daySave(){
	$('.daysave').off('click').on('click',function(){
		var data ={
			content:$('#content').val(),
			load:$('input[name=load]').val(),
			strength:$('input[name=strength]').val(),
			duration:$('input[name=duration]').val()
		};
		var index = $('.week').attr('data-tab');
		parts[index] = data;
		if(isAll(data)){
			$('.templet').eq(index).find('.fa-angle-right').addClass('green');
		}else{
			$('.templet').eq(index).find('.fa-angle-right').removeClass('green');
		}
		$('.bg').fadeOut();
		enable_back();
	})
}
function templet(){
	$('.templet').off('click').on('click',function(){
		var index = $(this).attr('data-tab');
		var name = $(this).find('.title').text();
		$('.week').text(name).attr('data-tab',index);
		fobidden_back();
		$('.bg').fadeIn();
		$.ajax({
			type:"post",
			url:"",
			data:{
				week:index
			},
			success:function(data){
				//返回模板
				var lists = $.parseJSON(data);
				var len = lists.length;
				var html = '';
				for(var i = 0 ; i< len ;i++){
					html +=	'<div>末班一</div>'
				}
				$('tems').html(html);
				//显示编辑过的训练内容、负荷量、负荷强度、时间
				$('#content').val(parts[index].content);
				$('input[name=load]').val(parts[index].load);
				$('input[name=strength]').val(parts[index].strength);
				$('input[name=duration]').val(parts[index].duration);
				temShow(data);
			}
		});
	})
}
function wordSum(){
	$('#need,#load,#content').on('input',function(){
		var len = $(this).val().length;
		$(this).next('.sum').find('span').text(len);
		if(len > 20){
			$(this).next('.sum').find('span').addClass('red');
		}else{
			$(this).next('.sum').find('span').removeClass('red');
		}
	});
}
function timeSelect(){
	var currYear = (new Date()).getFullYear();
	var opt={};
	opt.date = {preset : 'date'};
	opt.default = {
		theme: 'android-holo light',
		display: 'modal',
		mode: 'scroller',
		dateFormat: 'yyyy-mm-dd',
		lang: 'zh',
		showNow: true,
		nowText: "今天",
		startYear: currYear,
		endYear: currYear + 50,
		onSelect: function (valueText, inst) {
			var start = $('#start').val();
		}
	};
	$("#start").mobiscroll($.extend(opt['date'], opt['default']));
}
function temShow(data){
	$('.choose').off('click').on('click',function(){
		$('.tems').fadeIn();
		$('.tems div').off('click').on('click',function(){
			var index = $(this).index();
			$('input[name=load]').val(data[index].load);
			$('input[name=content]').val(data[index].content);
		});
	})
}

</script>
{/block}