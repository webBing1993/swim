{extend name="public/common"}

{block name="style"}
<title>签到频道</title>
<link rel="stylesheet" href="/home/css/visitor/lists.css">
{/block}

{block name="body"}
<div class="lists">
	<div class="list" data-tab="1">
		<div class="coach">
			<span class="name limit">教练：王某某</span>
			<span class="num limit">学员情况：1/25</span>
		</div>
		<div class="content">
			<div class="students">
				<div class="student">
					<span class="name limit">张三粒子</span>
					<span class="time limit">18:00:00</span>
					<span class="st limit">正常</span>
				</div>
				<div class="student">
					<span class="name limit">张三啊</span>
					<span class="time limit">18:00:00</span>
					<span class="st limit">正常</span>
				</div>
				<div class="student">
					<span class="name limit">张三啊</span>
					<span class="time limit">18:00:00</span>
					<span class="st limit">正常</span>
				</div>
			</div>
			<div class="more limit">更多...</div>
		</div>
	</div>
	<div class="list" data-tab="2">
		<div class="coach">
			<span class="name limit">教练：王某某</span>
			<span class="num limit">学员情况：1/25</span>
		</div>
		<div class="content">
			<div class="students">
				<div class="student">
					<span class="name limit">张三粒子</span>
					<span class="time limit">18:00:00</span>
					<span class="st limit">正常</span>
				</div>
				<div class="student">
					<span class="name limit">张三啊</span>
					<span class="time limit">18:00:00</span>
					<span class="st limit">正常</span>
				</div>
				<div class="student">
					<span class="name limit">张三啊</span>
					<span class="time limit">18:00:00</span>
					<span class="st limit">正常</span>
				</div>
			</div>
			<div class="more limit">更多...</div>
		</div>
	</div>
</div>
<input type="text" autofocus class="number" maxlength="11">
<!--<div class="sign">签到</div>-->
<div class="bg"></div>
<ul class="roster">
	<li>
	<span class="name limit">张三粒子</span>
	<span class="time limit">18:00:00</span>
	<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
	<li>
		<span class="name limit">张三粒子</span>
		<span class="time limit">18:00:00</span>
		<span class="st limit">正常</span>
	</li>
</ul>
{/block}

{block name="script"}
<script>
$(function(){
	var wh = $(window).height();
	$('body').height(wh);
	//签到
	var last = '';
	$('.number').on('input',function(){
		var this_ = $(this);
		var num = this_.val();
		if(num.length == 11 ){
			if(last!=num){
				//this_.blur();
				last = num;
				$.ajax({
					type:"post",
					url:"{:Url('Visitor/sign')}",
					data:{
						mobile: num
					},
					dataType: "Json",
					success:function(data){
//						speckText(data.msg);
						if(data.code == 1){
							swal({
								title: '成功',
								text: data.msg,
								type: 'success',
								showConfirmButton:false,
								timer:3000
							}).then(
								function () {},
								function (dismiss) {
									if (dismiss === 'timer') {
										this_.val('');
									}
								}
							);
						}else{
							swal({
								title: '失败',
								text: data.msg,
								type: 'error',
								showConfirmButton:false,
								//							confirmButtonText:'确定',
								timer:3000
							}).then(
								function () {},
								function (dismiss) {
									if (dismiss === 'timer') {
										this_.val('');
									}
								}
							);
						}
					}
				})
			}else{
				this_.val('');
			}
		}

	});
	//点击更多的名单
	$(".lists").delegate(".more", "click", function () {
		var this_ = $(this);
		var id = $(this).parents('.list').attr('data-tab');
		$.ajax({
			type:"post",
			url:"",
			data:{
				id: id
			},
			dataType: "Json",
			success:function(data){
				var lists = data;
				var len = lists.length;
				var html = '';
				for(var i = 0 ;i<len;i++){
					var list = lists[i];
					html+=
						'<li>'+
						'<span class="name limit">张三粒子</span>'+
						'<span class="time limit">18:00:00</span>'+
						'<span class="st limit">正常</span>'+
						'</li>'
				}
				$('.roster').html(html);
				$('.bg,.roster').fadeIn();
			}
		})
	});
	//初始化签到
	$('.sign').on('click',function(){
		history.go(0)
	});
	$('.bg').off('click').on('click',function(){
		$('.bg,.roster').fadeOut();
	});

});
function speckText(str){
	//var request=  new URLRequest();
	var url = "http://tts.baidu.com/text2audio?lan=zh&ie=UTF-8&text=" + encodeURI(str);        // baidu
	//url = "http://translate.google.cn/translate_tts?ie=UTF-8&tl=zh-CN&total=1&idx=0&textlen=19&prev=input&q=" + encodeURI(str); // google

	//request.url = encodeURI(url);
	// request.contentType = "audio/mp3"; // for baidu
	//request.contentType = "audio/mpeg"; // for google

	var n = new Audio(url);

	n.src = url;

	n.play();

	// $("...").play();
	// var sound = new Sound(request);
	// sound.play();
}
</script>
{/block}